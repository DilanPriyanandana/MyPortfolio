<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer Manage</title>
    <meta content="width=device-width initial-scale=1" name="viewport">
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="../assets/css/styles.css" rel="stylesheet">
    <link crossorigin="anonymous" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
          integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" rel="stylesheet">
    <style>
        ul > li {
            cursor: pointer;
        }
    </style>
</head>
<body>
<!--header-->

<header class="jumbotron bg-primary text-white p-3">
    <h1 class="position-absolute" id="nav"></h1>
    <ul class="list-group list-group-horizontal text-light justify-content-start font-weight-bold">
        <a class="navbar-brand fw-bold text-dark" href="#">
        <img src="../assets/img/cart%20logo.png" alt="Bootstrap" width="40" height="40"> POS System
        <li class="list-group-item bg-white" id="lnkHome"><a href="../index.html">Home</a></li>
        <li class="list-group-item bg-danger text-white" id="lnkCustomer"><a class="text-white" href="customer.html">Customer</a></li>
        <li class="list-group-item bg-white" id="lnkItem"><a href="item.html">Item</a></li>
        <li class="list-group-item bg-white" id="lnkOrders"><a href="purchase-order.html">Orders</a></li>
        </a>
    </ul>
</header>

<!--customer content-->
<main class="justify-content-center mt-4 align-content-center" id="customerContent">
    <section class="row col-12">
        <section  class="col-9 mx-0 my-4">
            <div class="font-weight-bolder text-dark text-center" style="font-size: 2.5rem">Customer Form</div>
            <section id="table" class="mx-4">
                <table class="table table-bordered text-white">
                    <thead class="bg-secondary">
                    <tr id="tableHeader">
                        <th scope="col">ID</th>
                        <th scope="col">Name</th>
                        <th scope="col">Address</th>
                        <th scope="col">Salary</th>
                    </tr>
                    </thead>
                    <tbody class="bg-light text-dark" id="tblCustomer">
                    </tbody>
                </table>
            </section>
        </section>

        <section class="col-3 justify-content-center my-4 " >
            <section class="card">
                <div class="card-header bg-primary  font-weight-bolder text-light">Customer Registration</div>
                <form id="item-form px-2" >
                    <div class="m-3">
                        <label for="txtCustomerID" class="form-label">Customer ID</label>
                        <input type="text" class="form-control "  id="txtCustomerID">
                    </div>
                    <div class="m-3">
                        <label for="txtCustomerName" class="form-label">Name</label>
                        <input type="text" class="form-control"  id="txtCustomerName" >
                    </div>
                    <div class="m-3">
                        <label for="txtCustomerAddress" class="form-label">Address</label>
                        <input type="text" class="form-control"  id="txtCustomerAddress" >
                    </div>
                    <div class="m-3">
                        <label for="txtCustomerSalary" class="form-label">Salary</label>
                        <input type="text" class="form-control"  id="txtCustomerSalary" >
                    </div>

                    <div class="m-3 justify-content-center">
                        <div style="display: inline-block" class="me-2">
                            <button id="btnCustomer" type="button" class="btn btn-success">Save</button>
                        </div>
                        <div style="display: inline-block" class="me-2">
                            <button id="btnUpdate" type="button" class="btn btn-primary">Update</button>
                        </div>
                        <div style="display: inline-block" class="me-2">
                            <button id="btnCusDelete" type="button" class="btn btn-danger">Delete</button>
                        </div>
                        <div style="display: inline-block" class="me-2">
                            <button id="btnClear" type="button" class="btn btn-warning">Clear</button>
                        </div>
                        <div style="display: inline-block">
                            <button id="btnGetAll" type="button" class="btn btn-secondary">Get All</button>
                        </div>
                    </div>

                </form>
            </section>
        </section>
    </section>
</main>


<script src="../../js/jquery-3.6.1.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>

<!--Customer Manage-->
<script>

    var customerDB = [
        {id: "C001", name: "Dasun", address: "Galle", salary: 100000},
        {id: "C002", name: "Kamal", address: "Panadura", salary: 200000},
        {id: "C003", name: "Wimal", address: "Panadura", salary: 300000}
    ];

    //load all existing customers
    getAllCustomers();

    <!-- Select Save Customer Btn and Bind an event   -->
    $("#btnCustomer").click(function () {
        saveCustomer();
    });

    // get all event
    $("#btnGetAll").click(function () {
        getAllCustomers();
    });


    //bind table tr events
    function bindTrEvents() {
        $('#tblCustomer>tr').click(function () {
            //get the selected rows data
            let id = $(this).children().eq(0).text();
            let name = $(this).children().eq(1).text();
            let address = $(this).children().eq(2).text();
            let salary = $(this).children().eq(3).text();

            //set the selected rows data to the input fields
            $("#txtCustomerID").val(id);
            $("#txtCustomerName").val(name);
            $("#txtCustomerAddress").val(address);
            $("#txtCustomerSalary").val(salary);
        })
    }


    //delete btn event
    $("#btnCusDelete").click(function () {
        let id = $("#txtCustomerID").val();

        let consent = confirm("Do you want to delete.?");
        if (consent) {
            let response = deleteCustomer(id);
            if (response) {
                alert("Customer Deleted");
                clearCustomerInputFields();
                getAllCustomers();
            } else {
                alert("Customer Not Removed..!");
            }
        }


    });

    //update event
    $("#btnUpdate").click(function () {
        let id = $("#txtCustomerID").val();
        updateCustomer(id);
        clearCustomerInputFields();
    });

    $("#btn-clear1").click(function () {
        clearCustomerInputFields();
    });


    function saveCustomer() {
        let customerID = $("#txtCustomerID").val();

        let idPattern = /^(C)[0-9]{3}$/;
        if (idPattern.test($("#txtCustomerID").val())){
            $("#txtCustomerID").css('border','2px solid blue');
        }else{
            $("#txtCustomerID").css('border','2px solid red')
            if (e.key==='Enter'){
                console.log(e);
                e.preventDefault();
            }
        }

        let namePattern = /^[A-Za-z\s]+$/;
        if (namePattern.test($("#txtCustomerName").val())){
            $("#txtCustomerName").css('border','2px solid blue');
        }else{
            $("#txtCustomerName").css('border','2px solid red')
            if (e.key==='Enter'){
                console.log(e);
                e.preventDefault();
            }
        }

        let addressPattern = /^[a-zA-Z\s']+$/u;

        if (addressPattern.test($("#txtCustomerAddress").val())){
            $("#txtCustomerAddress").css('border','2px solid blue');
        }else{
            $("#txtCustomerAddress").css('border','2px solid red')
            if (e.key==='Enter'){
                console.log(e);
                e.preventDefault();
            }
        }

        let salaryPattern = /^\$?\d+(,\d{3})*(\.\d{2})?$/;
        if (salaryPattern.test($("#txtCustomerSalary").val())){
            $("#txtCustomerSalary").css('border','2px solid blue');
        }else{
            $("#txtCustomerSalary").css('border','2px solid red')
            if (e.key==='Enter'){
                console.log(e);
                e.preventDefault();
            }
        }


        if (searchCustomer(customerID.trim()) == undefined) {
            let customerName = $("#txtCustomerName").val();
            let customerAddress = $("#txtCustomerAddress").val();
            let customerSalary = $("#txtCustomerSalary").val();

            //set customer details to another array
            // let customer=[customerID,customerName,customerAddress,customerSalary];

            let customerOb = {
                id: customerID,
                name: customerName,
                address: customerAddress,
                salary: customerSalary
            }

            //add customer record to the customer array
            customerDB.push(customerOb);
            clearCustomerInputFields();
            getAllCustomers();

        } else {
            alert("Customer already exits.!");
            clearCustomerInputFields();
        }
    }

    function getAllCustomers() {
        //clear all tbody data before add
        $("#tblCustomer").empty();

        //get all customers
        for (let i = 0; i < customerDB.length; i++) {
            let id = customerDB[i].id;
            let name = customerDB[i].name;
            let address = customerDB[i].address;
            let salary = customerDB[i].salary;

            let row = `<tr>
                     <td>${id}</td>
                     <td>${name}</td>
                     <td>${address}</td>
                     <td>${salary}</td>
                    </tr>`;

            // //and then append the row to tableBody
            $("#tblCustomer").append(row);

            //invoke this method every time
            // we add a row // otherwise click
            //event will not work
            bindTrEvents();


        }
    }

    function deleteCustomer(id) {
        for (let i = 0; i < customerDB.length; i++) {
            if (customerDB[i].id == id) {
                customerDB.splice(i, 1);
                return true;
            }
        }
        return false;
    }

    function searchCustomer(id) {
        return customerDB.find(function (customer) {
            //if the search id match with customer record
            //then return that object
            return customer.id == id;
        });
    }


    function updateCustomer(id) {
        if (searchCustomer(id) == undefined) {
            alert("No such Customer..please check the ID");
        } else {
            let consent = confirm("Do you really want to update this customer.?");
            if (consent) {
                let customer = searchCustomer(id);
                //if the customer available can we update.?

                let customerName = $("#txtCustomerName").val();
                let customerAddress = $("#txtCustomerAddress").val();
                let customerSalary = $("#txtCustomerSalary").val();

                customer.name = customerName;
                customer.address = customerAddress;
                customer.salary = customerSalary;

                getAllCustomers();
            }
        }

    }

    function clearCustomerInputFields() {
        $("#txtCustomerID,#txtCustomerName,#txtCustomerAddress,#txtCustomerSalary").val("");
        $("#txtCustomerID").focus();
    }


    //disable tab
    $("#txtCustomerID,#txtCustomerName,#txtCustomerAddress,#txtCustomerSalary").keydown(function (e) {

        if (e.key == "Tab") {
            e.preventDefault();
        }
    });

    $("#txtCustomerID").keydown(function (e) {
        if (e.key == "Enter") {
            $("#txtCustomerName").focus();
        }
    });

    $("#txtCustomerName").keydown(function (e) {
        if (e.key == "Enter") {
            $("#txtCustomerAddress").focus();
        }
    });

    $("#txtCustomerAddress").keydown(function (e) {
        if (e.key == "Enter") {
            $("#txtCustomerSalary").focus();
        }
    });

    $("#txtCustomerSalary").keydown(function (e) {
        if (e.key == "Enter") {
            //save customer
            saveCustomer();

        }
    });
</script>
</body>
</html>
