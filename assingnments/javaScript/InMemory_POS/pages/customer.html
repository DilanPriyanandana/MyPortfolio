<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer Manage</title>
    <meta content="width=device-width initial-scale=1" name="viewport">
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="../assets/css/styles.css" rel="stylesheet">
    <link crossorigin="anonymous" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
          integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" rel="stylesheet">
    <style>
        ul > li {
            cursor: pointer;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg bg-info">
    <div class="container-fluid">
        <a class="navbar-brand" >
            <img src="../assets/img/shop.png" alt="Logo" width="60" height="44" class="d-inline-block align-text-top">
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link active text-white" aria-current="page" href="../index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link text-white" href="../pages/customer.html">Customers</a></li>
                <li class="nav-item"><a class="nav-link text-white" href="../pages/item.html">Items</a></li>
                <li class="nav-item"><a class="nav-link text-white" href="../pages/purchase-order.html">Orders</a></li>
            </ul>

        </div>
    </div>
</nav>


<!--customer content-->

<main class="container-fluid justify-content-center mt-4 align-content-center" id="customerContent">
    <h1 class="text-center font-weight-bolder text-dark">Customer Form</h1>
    <section class="row col-12">

        <section  class="col-12 my-5">
            <section class="card">
                <div class="card-header bg-info font-weight-bolder text-light text-center">Input Details</div>

                <form class="item-form px-5" >
                    <div class="row">

                        <div class="col-6">
                            <label for="txtCustomerID" class="form-label"></label>
                            <input type="text" placeholder="Customer ID" class="form-control "  id="txtCustomerID">
                        </div>
                        <div class="col-6">
                            <label for="txtCustomerName" class="form-label"></label>
                            <input type="text" placeholder="Customer Name" class="form-control"  id="txtCustomerName" >
                        </div>
                        <div class="col-6">
                            <label for="txtCustomerAddress" class="form-label"></label>
                            <input type="text" placeholder="Customer Address" class="form-control"  id="txtCustomerAddress" >
                        </div>
                        <div class="col-6">
                            <label for="txtCustomerContact" class="form-label"></label>
                            <input type="text" placeholder="Customer Contact" class="form-control"  id="txtCustomerContact" >
                        </div>
                    </div>


                    <div class="m-3 justify-content-center">
                        <div style="display: inline-block" class="me-2">
                            <button id="btnCustomer" type="button" class="btn btn-success">Save</button>
                        </div>
                        <div style="display: inline-block" class="me-2">
                            <button id="btnUpdate" type="button" class="btn btn-primary">Update</button>
                        </div>
                        <div style="display: inline-block" class="me-2">
                            <button id="btnCusDelete" type="button" class="btn btn-danger">Delete</button>
                        </div>
                        <div style="display: inline-block" class="me-2">
                            <button id="btn-clear1" type="button" class="btn btn-warning">Clear</button>
                        </div>
                        <div style="display: inline-block">
                            <button id="btnGetAll" type="button" class="btn btn-secondary">Get All</button>
                        </div>
                    </div>

                </form>
            </section>
        </section>

        <section  class="col-12 mx-0 my-4 justify-content-center">
            <section class="mx-4">
                <table class="table table-bordered text-white">
                    <thead >
                    <tr>
                        <th scope="col" class="bg-secondary">ID</th>
                        <th scope="col" class="bg-secondary">Name</th>
                        <th scope="col" class="bg-secondary">Address</th>
                        <th scope="col" class="bg-secondary">Contact</th>
                    </tr>
                    </thead>
                    <tbody class="bg-light text-dark" id="tblCustomer">
                    </tbody>
                </table>
            </section>
        </section>
    </section>
</main>

<script src="../../js/jquery-3.6.1.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>

<!--Customer Manage-->
<script>

    var customerDB = [
        {id: "C001", name: "Dasun", address: "Galle", contact: "0771234567"},
        {id: "C002", name: "Kamal", address: "Panadura", contact: "0771234567"},
        {id: "C003", name: "Wimal", address: "Panadura", contact: "0771234567"}
    ];

    //load all existing customers
    getAllCustomers();

    <!-- Select Save Customer Btn and Bind an event   -->
    $("#btnCustomer").click(function () {
        saveCustomer();
    });

    // get all event
    $("#btnGetAll").click(function () {
        getAllCustomers();
    });


    //bind table tr events
    function bindTrEvents() {
        $('#tblCustomer>tr').click(function () {
            //get the selected rows data
            let id = $(this).children().eq(0).text();
            let name = $(this).children().eq(1).text();
            let address = $(this).children().eq(2).text();
            let contact= $(this).children().eq(3).text();

            //set the selected rows data to the input fields
            $("#txtCustomerID").val(id);
            $("#txtCustomerName").val(name);
            $("#txtCustomerAddress").val(address);
            $("#txtCustomerContact").val(contact);
        })
    }


    //delete btn event
    $("#btnCusDelete").click(function () {
        let id = $("#txtCustomerID").val();

        let consent = confirm("Do you want to delete.?");
        if (consent) {
            let response = deleteCustomer(id);
            if (response) {
                alert("Customer Deleted");
                clearCustomerInputFields();
                getAllCustomers();
            } else {
                alert("Customer Not Removed..!");
            }
        }


    });

    //update event
    $("#btnUpdate").click(function () {
        let id = $("#txtCustomerID").val();
        updateCustomer(id);
        clearCustomerInputFields();
    });

    $("#btn-clear1").click(function () {
        clearCustomerInputFields();
    });


    function saveCustomer() {
        let customerID = $("#txtCustomerID").val();

        let idPattern = /^(C)[0-9]{3}$/;
        if (idPattern.test($("#txtCustomerID").val())){
            $("#txtCustomerID").css('border','2px solid blue');
        }else{
            $("#txtCustomerID").css('border','2px solid red')
            if (e.key==='Enter'){
                console.log(e);
                e.preventDefault();
            }
        }

        let namePattern = /^[A-Za-z\s]+$/;
        if (namePattern.test($("#txtCustomerName").val())){
            $("#txtCustomerName").css('border','2px solid blue');
        }else{
            $("#txtCustomerName").css('border','2px solid red')
            if (e.key==='Enter'){
                console.log(e);
                e.preventDefault();
            }
        }

        let addressPattern = /^[a-zA-Z\s']+$/u;

        if (addressPattern.test($("#txtCustomerAddress").val())){
            $("#txtCustomerAddress").css('border','2px solid blue');
        }else{
            $("#txtCustomerAddress").css('border','2px solid red')
            if (e.key==='Enter'){
                console.log(e);
                e.preventDefault();
            }
        }

        let contactPattern = /^[0-9]{10}$/;
        if (contactPattern.test($("#txtCustomerContact").val())){
            $("#txtCustomerContact").css('border','2px solid blue');
        }else{
            $("#txtCustomerContact").css('border','2px solid red')
            if (e.key==='Enter'){
                console.log(e);
                e.preventDefault();
            }
        }


        if (searchCustomer(customerID.trim()) == undefined) {
            let customerName = $("#txtCustomerName").val();
            let customerAddress = $("#txtCustomerAddress").val();
            let customerContact = $("#txtCustomerContact").val();

            //set customer details to another array
            // let customer=[customerID,customerName,customerAddress,customerContact];

            let customerOb = {
                id: customerID,
                name: customerName,
                address: customerAddress,
                contact: customerContact
            }

            //add customer record to the customer array
            customerDB.push(customerOb);
            clearCustomerInputFields();
            getAllCustomers();

        } else {
            alert("Customer already exits.!");
            clearCustomerInputFields();
        }
    }

    function getAllCustomers() {
        //clear all tbody data before add
        $("#tblCustomer").empty();

        //get all customers
        for (let i = 0; i < customerDB.length; i++) {
            let id = customerDB[i].id;
            let name = customerDB[i].name;
            let address = customerDB[i].address;
            let contact = customerDB[i].contact;

            let row = `<tr>
                     <td>${id}</td>
                     <td>${name}</td>
                     <td>${address}</td>
                     <td>${contact}</td>
                    </tr>`;

            // //and then append the row to tableBody
            $("#tblCustomer").append(row);

            //invoke this method every time
            // we add a row // otherwise click
            //event will not work
            bindTrEvents();


        }
    }

    function deleteCustomer(id) {
        for (let i = 0; i < customerDB.length; i++) {
            if (customerDB[i].id == id) {
                customerDB.splice(i, 1);
                return true;
            }
        }
        return false;
    }

    function searchCustomer(id) {
        return customerDB.find(function (customer) {
            //if the search id match with customer record
            //then return that object
            return customer.id == id;
        });
    }


    function updateCustomer(id) {
        if (searchCustomer(id) == undefined) {
            alert("No such Customer..please check the ID");
        } else {
            let consent = confirm("Do you really want to update this customer.?");
            if (consent) {
                let customer = searchCustomer(id);
                //if the customer available can we update.?

                let customerName = $("#txtCustomerName").val();
                let customerAddress = $("#txtCustomerAddress").val();
                let customerContact = $("#txtCustomerContact").val();

                customer.name = customerName;
                customer.address = customerAddress;
                customer.contact = customerContact;

                getAllCustomers();
            }
        }

    }

    function clearCustomerInputFields() {
        $("#txtCustomerID,#txtCustomerName,#txtCustomerAddress,#txtCustomerContact").val("");
        $("#txtCustomerID").focus();
    }


    //disable tab
    $("#txtCustomerID,#txtCustomerName,#txtCustomerAddress,#txtCustomerContact").keydown(function (e) {

        if (e.key == "Tab") {
            e.preventDefault();
        }
    });

    $("#txtCustomerID").keydown(function (e) {
        if (e.key == "Enter") {
            $("#txtCustomerName").focus();
        }
    });

    $("#txtCustomerName").keydown(function (e) {
        if (e.key == "Enter") {
            $("#txtCustomerAddress").focus();
        }
    });

    $("#txtCustomerAddress").keydown(function (e) {
        if (e.key == "Enter") {
            $("#txtCustomerContact").focus();
        }
    });

    $("#txtCustomerContact").keydown(function (e) {
        if (e.key == "Enter") {
            //save customer
            saveCustomer();

        }
    });
</script>
</body>
</html>
